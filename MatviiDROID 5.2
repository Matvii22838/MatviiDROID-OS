print("loading...")
os.execute("sleep 10")

-- MatviiDROID 5

-- –¢–∞–±–ª–∏—Ü—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
settings = {
    textColor = "default",
    language = "uk"
}

function colorPrint(text)
    if settings.textColor == "red" then
        print("\27[31m"..text.."\27[0m")
    elseif settings.textColor == "green" then
        print("\27[32m"..text.."\27[0m")
    else
        print(text)
    end
end

function text(key)
    local t = {
        ["main_title"] = {uk="MatviiDROID 5", en="MatviiDROID 5"},
        ["menu_settings"] = {uk="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è", en="Settings"},
        ["menu_calc"] = {uk="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", en="Calculator"},
        ["menu_info"] = {uk="–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–∏—Å—Ç–µ–º—É", en="System Info"},
        ["menu_games"] = {uk="–ú—ñ–Ω—ñ-—ñ–≥—Ä–∏", en="Mini Games"},
        ["cmd_invalid"] = {uk="–ù–µ–≤—ñ—Ä–Ω–∞ –∫–æ–º–∞–Ω–¥–∞", en="Invalid command"},
        ["back"] = {uk="back - –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é", en="back - Return to main menu"},
        ["developer"] = {uk="–†–æ–∑—Ä–æ–±–Ω–∏–∫: –ú–∞—Ç–≤—ñ–π –ü–µ—Ä–Ω–µ—Ä–æ–≤—Å—å–∫–∏–π", en="Developer: Matvii Pernerovskyi"},
        ["version"] = {uk="–í–µ—Ä—Å—ñ—è —Å–∏—Å—Ç–µ–º–∏: 5", en="System version: 5"},
        ["update_info"] = {uk="–î–æ–¥–∞–Ω–∞ –≥—Ä–∞ Roll –∑ 10 —Ä—ñ–≤–Ω—è–º–∏", en="Added Roll game with 10 levels"},
        ["enter_command"] = {uk="–í–≤–µ–¥–∏ –∫–æ–º–∞–Ω–¥—É: ", en="Enter command: "},
        ["settings_color"] = {uk="1. –ó–º—ñ–Ω–∏—Ç–∏ –∫–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É", en="1. Change text color"},
        ["settings_language"] = {uk="2. –ó–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É (uk/en)", en="2. Change language (uk/en)"},
        ["calc_prompt1"] = {uk="–ß–∏—Å–ª–æ 1: ", en="Number 1: "},
        ["calc_prompt2"] = {uk="–û–ø–µ—Ä–∞—Ü—ñ—è (+ - * /): ", en="Operation (+ - * /): "},
        ["calc_prompt3"] = {uk="–ß–∏—Å–ª–æ 2: ", en="Number 2: "},
        ["calc_result"] = {uk="–†–µ–∑—É–ª—å—Ç–∞—Ç: ", en="Result: "},
        ["games_rps"] = {uk="–ö–∞–º—ñ–Ω—å-–Ω–æ–∂–∏—Ü—ñ-–ø–∞–ø—ñ—Ä", en="Rock-Paper-Scissors"},
        ["rps_prompt"] = {uk="–¢–≤—ñ–π –≤–∏–±—ñ—Ä: ", en="Your choice: "},
        ["rps_computer"] = {uk="–ö–æ–º–ø'—é—Ç–µ—Ä –≤–∏–±—Ä–∞–≤: ", en="Computer chose: "},
        ["rps_win"] = {uk="–¢–∏ –≤–∏–≥—Ä–∞–≤!", en="You win!"},
        ["rps_lose"] = {uk="–¢–∏ –ø—Ä–æ–≥—Ä–∞–≤!", en="You lose!"},
        ["rps_draw"] = {uk="–ù—ñ—á–∏—è!", en="Draw!"}
    }
    return t[key][settings.language]
end

-- –†–æ–±–æ—á–∏–π —Å—Ç—ñ–ª
desktop = {"settings","info","calc","files","notes"}

-- –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é
function mainMenu()
    while true do
        print("\n==============================")
        colorPrint("        "..text("main_title").."       ")
        print("==============================\n")
        for _, app in ipairs(desktop) do
            print(app)
        end
        print("games")
        print("")
        io.write(text("enter_command"))
        local cmd = io.read()
        if cmd == "settings" then
            settingsMenu()
        elseif cmd == "calc" then
            calculator()
        elseif cmd == "info" then
            systemInfo()
        elseif cmd == "files" then
            fileExplorer()
        elseif cmd == "notes" then
            notesApp()
        elseif cmd == "games" then
            miniGames()
        else
            print(text("cmd_invalid"))
        end
    end
end

-- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
function settingsMenu()
    while true do
        print("\n------ "..text("menu_settings").." ------\n")
        print(text("settings_color"))
        print(text("settings_language"))
        print(text("back").."\n")
        io.write(text("enter_command"))
        local cmd = io.read()
        if cmd == "1" then
            io.write("–í–≤–µ–¥–∏ –∫–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É: ")
            local color = io.read()
            settings.textColor = color
        elseif cmd == "2" then
            io.write("–í–≤–µ–¥–∏ –º–æ–≤—É (uk/en): ")
            local lang = io.read()
            if lang == "uk" or lang == "en" then
                settings.language = lang
                print("–ú–æ–≤–∞ –∑–º—ñ–Ω–µ–Ω–∞ / Language changed: "..lang)
            else
                print(text("cmd_invalid"))
            end
        elseif cmd == "back" then
            break
        else
            print(text("cmd_invalid"))
        end
    end
end

-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
function calculator()
    while true do
        print("\n------ "..text("menu_calc").." ------\n")
        print(text("back"))
        io.write(text("calc_prompt1"))
        local a = io.read()
        if a == "back" then break end
        a = tonumber(a)
        io.write(text("calc_prompt2"))
        local op = io.read()
        io.write(text("calc_prompt3"))
        local b = io.read()
        if b == "back" then break end
        b = tonumber(b)
        local result
        if op == "+" then result = a + b
        elseif op == "-" then result = a - b
        elseif op == "*" then result = a * b
        elseif op == "/" then result = a / b
        else
            print(text("cmd_invalid"))
        end
        if result then print(text("calc_result")..result) end
    end
end

-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–∏—Å—Ç–µ–º—É
function systemInfo()
    while true do
        print("\n------ "..text("menu_info").." ------\n")
        print(text("developer"))
        print(text("version"))
        print(text("update_info"))
        print(text("back"))
        local cmd = io.read()
        if cmd == "back" then break end
    end
end

-- –ü—Ä–æ–≤—ñ–¥–Ω–∏–∫ —Ñ–∞–π–ª—ñ–≤
function fileExplorer()
    print("\n–í—ñ—Ç–∞—é! –¶–µ —Ç–≤—ñ–π –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π –ø—Ä–æ–≤—ñ–¥–Ω–∏–∫ üóÇÔ∏è")
    print("–¢—É—Ç –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Ñ–∞–π–ª–∏ —ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è")
end

-- –ù–æ—Ç–∞—Ç–∫–∏
function notesApp()
    print("\n–í—ñ—Ç–∞—é! –¶–µ —Ç–≤—ñ–π –ª–æ–∫–∞–ª—å–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ üìã")
    print("–¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ—Ç–∞—Ç–∫–∏")
end

-- –ú—ñ–Ω—ñ-—ñ–≥—Ä–∏
function miniGames()
    while true do
        print("\n------ "..text("menu_games").." ------\n")
        print("1. "..text("games_rps"))
        print("2. Roll")
        print(text("back").."\n")
        io.write(text("enter_command"))
        local cmd = io.read()
        if cmd == "1" then
            rockPaperScissors()
        elseif cmd == "2" then
            rollGame()
        elseif cmd == "back" then
            break
        else
            print(text("cmd_invalid"))
        end
    end
end

-- –ö–∞–º—ñ–Ω—å-–Ω–æ–∂–∏—Ü—ñ-–ø–∞–ø—ñ—Ä
function rockPaperScissors()
    local options = {"–∫–∞–º—ñ–Ω—å", "–Ω–æ–∂–∏—Ü—ñ", "–ø–∞–ø—ñ—Ä"}
    print("\n"..text("games_rps").." ("..text("back")..")")
    while true do
        io.write(text("rps_prompt"))
        local player = io.read()
        if player == "back" then break end
        local computer = options[math.random(1,3)]
        print(text("rps_computer")..computer)
        if player == computer then
            print(text("rps_draw"))
        elseif (player=="–∫–∞–º—ñ–Ω—å" and computer=="–Ω–æ–∂–∏—Ü—ñ") or
               (player=="–Ω–æ–∂–∏—Ü—ñ" and computer=="–ø–∞–ø—ñ—Ä") or
               (player=="–ø–∞–ø—ñ—Ä" and computer=="–∫–∞–º—ñ–Ω—å") then
            print(text("rps_win"))
        else
            print(text("rps_lose"))
        end
    end
end

-- –ì—Ä–∞ Roll
function rollGame()
    local levels = {
        {
            "#########",
            "#@   # +#",
            "# ###  ##",
            "#       #",
            "#########"
        },
        {
            "#########",
            "# @#   +#",
            "#  ###  #",
            "#       #",
            "#########"
        },
        -- 8 —ñ–Ω—à–∏—Ö —Ä—ñ–≤–Ω—ñ–≤ —Ç—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ
    }
    local playerX, playerY
    for lvl=1,#levels do
        local map = levels[lvl]
        -- –∑–Ω–∞–π—Ç–∏ @
        for y=1,#map do
            local row = map[y]
            local x = row:find("@")
            if x then playerX, playerY = x, y end
        end
        while true do
            -- –ø–æ–∫–∞–∑–∞—Ç–∏ —Ä—ñ–≤–µ–Ω—å
            for y=1,#map do print(map[y]) end
            print("–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π W/A/S/D —â–æ–± —Ä—É—Ö–∞—Ç–∏—Å—å, back –¥–ª—è –≤–∏—Ö–æ–¥—É")
            local move = io.read():lower()
            if move=="back" then return end
            local dx,dy=0,0
            if move=="w" then dy=-1
            elseif move=="s" then dy=1
            elseif move=="a" then dx=-1
            elseif move=="d" then dx=1
            end
            local newX,newY=playerX+dx,playerY+dy
            local row = map[newY]
            if row then
                local tile = row:sub(newX,newX)
                if tile~="#" then
                    row = row:sub(1,newX-1).."@"..row:sub(newX+1)
                    row = map[playerY]:sub(1,playerX-1).." "..map[playerY]:sub(playerX+1)
                    map[newY]=row
                    map[playerY]=map[playerY]:sub(1,playerX-1).." "..map[playerY]:sub(playerX+1)
                    playerX,playerY=newX,newY
                end
                if tile=="+" then break end
            end
        end
    end
    print("–¢–∏ –ø—Ä–æ–π—à–æ–≤ —É—Å—ñ —Ä—ñ–≤–Ω—ñ! –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞ —Ä–æ–±–æ—á–∏–π —Å—Ç—ñ–ª.")
end

-- –°—Ç–∞—Ä—Ç –ø—Ä–æ–≥—Ä–∞–º–∏
mainMenu()
